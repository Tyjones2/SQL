--1. Create a CTE that selects employees and jobtitle who earn a salary above $50,000.
WITH highest_pay AS (
    SELECT employeename, jobtitle, totalpay
    from salaries
    WHERE totalpay > 30000
)
SELECT employeename, jobtitle, totalpay
FROM highest_pay;




-- *"Find all job titles where the highest-paid employee earns at least 3x more than the title's average pay."*

WITH all_jobtitles AS (
    SELECT 
    jobtitle,
    MAX(totalpay) AS max_tp,
    AVG(totalpay) AS avg_tp
    FROM salaries
    group by jobtitle
)
SELECT jobtitle,
    max_tp,
    avg_tp
    from all_jobtitles
    WHERE max_tp >= 3* avg_tp
    order by jobtitle;
